(function(window,$){'use strict';function getSlug(link){var re=/\/category\/([^\/]+)/gm,slugCheck=re.exec(link),slug=(slugCheck)?slugCheck[1]:'';return slug;}
function parseQueryString(queryString){var match,urlParams={},pl=/\+/g,search=/([^&=]+)=?([^&]*)/g,decode=function(s){return decodeURIComponent(s.replace(pl," "));},query=queryString.substring(1);while((match=search.exec(query))!==null){urlParams[decode(match[1])]=decode(match[2]);}
return urlParams;}
function setActiveCategoryClasses(element){var link=$(element),href=link.attr('href');var slug=getSlug(href);if(''===slug){$allLink=$(element);$subscribe.attr('href',subscribeURL+'?feed=rss2');}
if(currentCategories.length){if(''!==slug&&$.inArray(slug,currentCategories)>-1){link.addClass('active');}}else{$allLink.addClass('active');}}
function resetFilters(){$allLink.addClass('active');$filterContainer.show();$('.filtered-appended').remove();$(document.getElementById('post-loading')).remove();$subscribe.attr('href',subscribeURL+'?feed=rss2');}
function changeUrl(activeSlugs){var categories=activeSlugs.join(',');var uri;if(categories.length){uri='?filter=true&filter-category='+categories;}else{uri="/"+removeFiltersFromUri(window.location.search);}
history.pushState({activeSlugs:activeSlugs},"",uri);$('a.page-numbers').each(function(i,link){var uri=decodeURIComponent($(link).attr('href'));$(link).attr('href',removeFiltersFromUri(uri)+location.search);});}
function removeFiltersFromUri(uri){return uri.replace(/filter=true&filter-category=[a-z0-9,-]*/,'').replace(/\?&/,'?').replace(/\?$/,'');}
if($(document.getElementById('active-posts-filter')).length){var $filter=$(document.getElementById('active-posts-filter')),$archiveFilter=$(document.getElementById('posts-filter')),$filterLink=$filter.find('li a'),$archiveFilterLink=$archiveFilter.find('li a'),$filterContainer=$(document.getElementById('filtered-post-container')),$subscribe=$(document.getElementById('subscribe-link')),subscribeURL=$subscribe.attr('href'),pageOneUrl=$($('a.page-numbers')[0]).attr('href').replace(window.location.search,""),activeSlugs=[],$allLink;$filter.find('.current-menu-item').removeClass('current-menu-item');var currentCategories=window.location.search.split('filter-category=');if(2===currentCategories.length){currentCategories=decodeURIComponent(currentCategories[1]).replace(/,$/,"").split(',');activeSlugs=currentCategories;}else{currentCategories=false;}
$filterLink.each(function(){setActiveCategoryClasses(this);});$archiveFilterLink.each(function(){setActiveCategoryClasses(this);});$filterLink.on('click',function(e){e.preventDefault();var link=$(this),href=link.attr('href'),slug,slugindex;$('.filtered-appended').hide();$filterContainer.hide().before('<div id="post-loading" class="loading"></div>');if(''===getSlug(href)){activeSlugs=[];console.log('removing active classes on filter  links');$filterLink.removeClass('active');resetFilters();}else{slug=getSlug(href);slugindex=activeSlugs.indexOf(slug);if(slugindex>-1){activeSlugs.splice(slugindex,1);link.removeClass('active');if(!activeSlugs.length){resetFilters();}}else{activeSlugs.push(slug);console.log('removing active link from all link');$allLink.removeClass('active');link.addClass('active');}
$subscribe.attr('href',subscribeURL+'?cat='+activeSlugs.join(',')+'&feed=rss2');$.ajax({url:Windows_Blogs.ajaxurl,type:'POST',data:{action:Windows_Blogs.action_filter_posts,nonce:Windows_Blogs.nonce_filter,category_slug:activeSlugs.join(','),template:Windows_Blogs.template},success:function(response){if(response.success===false){window.console.log(response.data.message);return;}
window.console.log('got posts!');var tempDom=$.parseHTML(response);$filterContainer.hide();$('.filtered-appended').remove();$(document.getElementById('post-loading')).remove();$filterContainer.after(tempDom);var new_addthis=$('.addthis_toolbox',$(tempDom));new_addthis.each(function(){var addthis=$(this),addthis_counter=$(this).find('.addthis_bubble_style');window.addthis.toolbox(addthis[0]);window.addthis.counter(addthis_counter[0]);});}});}
changeUrl(activeSlugs);});$archiveFilterLink.on('click',function(e){e.preventDefault();var link=$(this),href=link.attr('href'),slug,newQueryString,urlParams,slugindex;var redirectUrl=pageOneUrl;if(''!==getSlug(href)){slug=getSlug(href);var categorySet=currentCategories&&($.inArray(slug,currentCategories)>-1);if(categorySet){newQueryString=window.location.search.replace(slug,"").replace(",,",",").replace(/,$/,"");urlParams=parseQueryString(newQueryString);if(-1===$.inArray(urlParams['filter-category'],["",","])){redirectUrl+=newQueryString;}}else{urlParams=parseQueryString(window.location.search);var categoriesString=urlParams['filter-category'];if(!!categoriesString&&""!==categoriesString){var categories=categoriesString.split(",");categories.push(slug);urlParams["filter-category"]=categories.join(',');}else{urlParams['filter-category']=slug;urlParams.filter="true";}
redirectUrl+="?"+$.param(urlParams);}}
window.location.href=redirectUrl;});}})(this,jQuery);